
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Alliance Napol√©oniens</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 30px;
    }
    .login-box, .admin-panel {
      background: var(--panel);
      padding: 30px;
      border-radius: var(--r);
      border: 1px solid var(--line);
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text);
      font-weight: 600;
    }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 12px;
      background: var(--panel2);
      border: 1px solid var(--line);
      border-radius: 8px;
      color: var(--text);
      font-family: inherit;
    }
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    .btn-primary {
      background: var(--brand);
      color: var(--bg);
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 16px;
    }
    .btn-primary:hover {
      opacity: 0.9;
    }
    .btn-danger {
      background: var(--danger);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
    }
    .hidden {
      display: none;
    }
    .unit-list {
      margin-top: 30px;
    }
    .unit-item {
      background: var(--panel2);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .unit-info h3 {
      margin: 0 0 5px 0;
      color: var(--brand);
    }
    .logout-btn {
      position: absolute;
      top: 20px;
      right: 20px;
    }
  </style>
</head>
<body>
  
  <div class="admin-container">
    <!-- Login Form -->
    <div id="loginBox" class="login-box">
      <h1>üîê Admin - Connexion</h1>
      <p style="color: var(--muted); margin-bottom: 30px">Connectez-vous pour g√©rer les unit√©s</p>
      
      <form id="loginForm">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="loginEmail" required>
        </div>
        <div class="form-group">
          <label>Mot de passe</label>
          <input type="password" id="loginPassword" required>
        </div>
        <button type="submit" class="btn-primary">Se connecter</button>
        <p id="loginError" style="color: var(--danger); margin-top: 15px"></p>
      </form>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel hidden">
      <button class="btn-danger logout-btn" id="logoutBtn">D√©connexion</button>
      
      <h1>‚öôÔ∏è Gestion des Unit√©s</h1>
      <p style="color: var(--muted); margin-bottom: 30px">Ajouter, modifier ou supprimer des unit√©s</p>

      <!-- Add/Edit Form -->
      <form id="unitForm">
        <div class="form-group">
          <label>Cat√©gorie</label>
          <select id="unitCategory" required>
            <option value="">S√©lectionner...</option>
            <option value="air">Air</option>
            <option value="terre">Terre</option>
            <option value="naval">Naval</option>
          </select>
        </div>

        <div class="form-group">
          <label>Nom de l'unit√©</label>
          <input type="text" id="unitName" required placeholder="Ex: ASF, Chars, Croiseur">
        </div>

        <div class="form-group">
          <label>Description courte</label>
          <input type="text" id="unitDesc" required placeholder="Ex: Sup√©riorit√© a√©rienne">
        </div>

        <div class="form-group">
          <label>Tag (ex: SUPERIORITY, CAPTURE, etc.)</label>
          <input type="text" id="unitTag" placeholder="Optionnel">
        </div>

        <div class="form-group">
          <label>Efficace contre (liste s√©par√©e par des virgules)</label>
          <textarea id="unitEffective" placeholder="Ex: Chasseurs, Bombardiers, H√©licopt√®res"></textarea>
        </div>

        <div class="form-group">
          <label>Faible contre (liste s√©par√©e par des virgules)</label>
          <textarea id="unitWeak" placeholder="Ex: ASF, Missiles AA"></textarea>
        </div>

        <div class="form-group">
          <label>√Ä ne pas faire (liste s√©par√©e par des virgules)</label>
          <textarea id="unitDont" placeholder="Ex: Engager sans couverture, Rester immobile"></textarea>
        </div>

        <div class="form-group">
          <label>Mots-cl√©s pour la recherche</label>
          <input type="text" id="unitKeywords" placeholder="Ex: asf chasseur superiority avion">
        </div>

        <button type="submit" class="btn-primary" id="submitBtn">Ajouter l'unit√©</button>
        <button type="button" class="btn-danger hidden" id="cancelEdit">Annuler</button>
      </form>

      <!-- Units List -->
      <div class="unit-list">
        <h2>Unit√©s existantes</h2>
        <div id="unitsList"></div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getDatabase, ref, set, push, remove, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBxewPqv1KKrv1b8ahFGgVfPpTDvzSgzj8",
      authDomain: "ww3-alliance.firebaseapp.com",
      projectId: "ww3-alliance",
      storageBucket: "ww3-alliance.firebasestorage.app",
      messagingSenderId: "715645349258",
      appId: "1:715645349258:web:4c424896668dd3f96eec73",
      databaseURL: "https://ww3-alliance-default-rtdb.europe-west1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentEditId = null;

    // Elements
    const loginBox = document.getElementById('loginBox');
    const adminPanel = document.getElementById('adminPanel');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const logoutBtn = document.getElementById('logoutBtn');
    const unitForm = document.getElementById('unitForm');
    const unitsList = document.getElementById('unitsList');
    const submitBtn = document.getElementById('submitBtn');
    const cancelEdit = document.getElementById('cancelEdit');

    // Check auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loginBox.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        loadUnits();
      } else {
        loginBox.classList.remove('hidden');
        adminPanel.classList.add('hidden');
      }
    });

    // Login
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        await signInWithEmailAndPassword(auth, email, password);
        loginError.textContent = '';
      } catch (error) {
        loginError.textContent = 'Email ou mot de passe incorrect';
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => signOut(auth));

    // Add/Edit Unit
    unitForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const unitData = {
        category: document.getElementById('unitCategory').value,
        name: document.getElementById('unitName').value,
        description: document.getElementById('unitDesc').value,
        tag: document.getElementById('unitTag').value,
        effective: document.getElementById('unitEffective').value.split(',').map(s => s.trim()).filter(s => s),
        weak: document.getElementById('unitWeak').value.split(',').map(s => s.trim()).filter(s => s),
        dont: document.getElementById('unitDont').value.split(',').map(s => s.trim()).filter(s => s),
        keywords: document.getElementById('unitKeywords').value
      };

      try {
        if (currentEditId) {
          await update(ref(db, 'units/' + currentEditId), unitData);
        } else {
          await push(ref(db, 'units'), unitData);
        }
        
        unitForm.reset();
        currentEditId = null;
        submitBtn.textContent = 'Ajouter l\'unit√©';
        cancelEdit.classList.add('hidden');
      } catch (error) {
        alert('Erreur: ' + error.message);
      }
    });

    // Cancel edit
    cancelEdit.addEventListener('click', () => {
      unitForm.reset();
      currentEditId = null;
      submitBtn.textContent = 'Ajouter l\'unit√©';
      cancelEdit.classList.add('hidden');
    });

    // Load units
    function loadUnits() {
      const unitsRef = ref(db, 'units');
      onValue(unitsRef, (snapshot) => {
        unitsList.innerHTML = '';
        const data = snapshot.val();
        
        if (!data) {
          unitsList.innerHTML = '<p style="color: var(--muted)">Aucune unit√© pour le moment</p>';
          return;
        }

        Object.entries(data).forEach(([id, unit]) => {
          const div = document.createElement('div');
          div.className = 'unit-item';
          div.innerHTML = `
            <div class="unit-info">
              <h3>${unit.name}</h3>
              <p style="color: var(--muted); margin: 0">${unit.category.toUpperCase()} - ${unit.description}</p>
            </div>
            <div>
              <button class="btn-primary" onclick="editUnit('${id}')">Modifier</button>
              <button class="btn-danger" onclick="deleteUnit('${id}')">Supprimer</button>
            </div>
          `;
          unitsList.appendChild(div);
        });
      });
    }

    // Edit unit
    window.editUnit = async (id) => {
      const snapshot = await onValue(ref(db, 'units/' + id), (snap) => {
        const unit = snap.val();
        document.getElementById('unitCategory').value = unit.category;
        document.getElementById('unitName').value = unit.name;
        document.getElementById('unitDesc').value = unit.description;
        document.getElementById('unitTag').value = unit.tag || '';
        document.getElementById('unitEffective').value = unit.effective.join(', ');
        document.getElementById('unitWeak').value = unit.weak.join(', ');
        document.getElementById('unitDont').value = unit.dont.join(', ');
        document.getElementById('unitKeywords').value = unit.keywords;
        
        currentEditId = id;
        submitBtn.textContent = 'Modifier l\'unit√©';
        cancelEdit.classList.remove('hidden');
        window.scrollTo(0, 0);
      }, { onlyOnce: true });
    };

    // Delete unit
    window.deleteUnit = async (id) => {
      if (confirm('Supprimer cette unit√© ?')) {
        await remove(ref(db, 'units/' + id));
      }
    };
  </script>
</body>
</html>
