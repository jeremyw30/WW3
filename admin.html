<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Admin - Alliance Napol√©oniens</title>
  <link rel="stylesheet" href="style.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .dashboard-layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--panel);
      border-right: 1px solid var(--line);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid var(--line);
      margin-bottom: 20px;
    }

    .sidebar-header h2 {
      color: var(--brand);
      font-size: 20px;
      margin-bottom: 5px;
    }

    .sidebar-header p {
      color: var(--muted);
      font-size: 13px;
    }

    .nav-menu {
      list-style: none;
    }

    .nav-item {
      margin: 5px 10px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      color: var(--text);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-link:hover {
      background: var(--panel2);
    }

    .nav-link.active {
      background: var(--brand);
      color: var(--bg);
      font-weight: 600;
    }

    .nav-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid var(--line);
      margin-top: 20px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 30px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--line);
    }

    .top-bar h1 {
      font-size: 28px;
      color: var(--text);
    }

    .logout-btn {
      background: var(--danger);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: opacity 0.2s;
    }

    .logout-btn:hover {
      opacity: 0.9;
    }

    /* KPI Cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .kpi-card {
      background: var(--panel);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--line);
      position: relative;
      overflow: hidden;
    }

    .kpi-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--brand);
    }

    .kpi-card.air::before { background: #3b82f6; }
    .kpi-card.terre::before { background: #22c55e; }
    .kpi-card.naval::before { background: #06b6d4; }

    .kpi-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .kpi-title {
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
    }

    .kpi-icon {
      font-size: 28px;
      opacity: 0.7;
    }

    .kpi-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 5px;
    }

    .kpi-label {
      color: var(--muted);
      font-size: 13px;
    }

    /* Sections */
    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .content-card {
      background: var(--panel);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid var(--line);
      margin-bottom: 20px;
    }

    .content-card h2 {
      margin-bottom: 20px;
      color: var(--text);
      font-size: 20px;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text);
      font-weight: 600;
      font-size: 14px;
    }

    .form-group input, 
    .form-group textarea, 
    .form-group select {
      width: 100%;
      padding: 12px;
      background: var(--panel2);
      border: 1px solid var(--line);
      border-radius: 8px;
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .btn-primary {
      background: var(--brand);
      color: var(--bg);
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: opacity 0.2s;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .btn-secondary {
      background: var(--panel2);
      color: var(--text);
      padding: 12px 24px;
      border: 1px solid var(--line);
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      margin-left: 10px;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
      font-size: 13px;
    }

    .hidden {
      display: none;
    }

    /* Unit List */
    .unit-item {
      background: var(--panel2);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .unit-info h3 {
      margin: 0 0 5px 0;
      color: var(--brand);
      font-size: 16px;
    }

    .unit-info p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    /* Chart Container */
    .chart-container {
      background: var(--panel2);
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .bar-chart {
      display: flex;
      align-items: flex-end;
      gap: 20px;
      height: 200px;
      padding: 20px 0;
    }

    .bar {
      flex: 1;
      background: var(--brand);
      border-radius: 8px 8px 0 0;
      position: relative;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
    }

    .bar:hover {
      opacity: 0.8;
    }

    .bar.air { background: #3b82f6; }
    .bar.terre { background: #22c55e; }
    .bar.naval { background: #06b6d4; }

    .bar-value {
      color: white;
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .bar-label {
      margin-top: 10px;
      color: var(--text);
      font-weight: 600;
      font-size: 14px;
    }

    /* Info Box */
    .info-box {
      background: var(--panel2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--warn);
    }

    .info-box strong {
      color: var(--warn);
    }

    /* Activity Log */
    .activity-item {
      padding: 15px;
      border-bottom: 1px solid var(--line);
      display: flex;
      gap: 15px;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      background: var(--panel2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .activity-time {
      color: var(--muted);
      font-size: 12px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }

      .sidebar-header h2,
      .sidebar-header p,
      .nav-link span {
        display: none;
      }

      .main-content {
        margin-left: 70px;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>‚öôÔ∏è Dashboard</h2>
        <p>Alliance Napol√©oniens</p>
      </div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a class="nav-link active" data-section="overview">
            <span class="nav-icon">üìä</span>
            <span>Vue d'ensemble</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-section="units">
            <span class="nav-icon">‚öîÔ∏è</span>
            <span>Gestion Unit√©s</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-section="activity">
            <span class="nav-icon">üìù</span>
            <span>Activit√© r√©cente</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-section="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Param√®tres</span>
          </a>
        </li>
      </ul>

      <div class="sidebar-footer">
        <button class="logout-btn" id="logoutBtn" style="width: 100%">
          üö™ D√©connexion
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="top-bar">
        <h1 id="pageTitle">Vue d'ensemble</h1>
        <div style="color: var(--muted); font-size: 14px">
          üë§ Admin connect√©
        </div>
      </div>

      <!-- Overview Section -->
      <section id="overview" class="section active">
        <!-- KPI Cards -->
        <div class="kpi-grid">
          <div class="kpi-card air">
            <div class="kpi-header">
              <span class="kpi-title">Unit√©s Air</span>
              <span class="kpi-icon">‚úàÔ∏è</span>
            </div>
            <div class="kpi-value" id="airCount">0</div>
            <div class="kpi-label">unit√©s cr√©√©es</div>
          </div>

          <div class="kpi-card terre">
            <div class="kpi-header">
              <span class="kpi-title">Unit√©s Terre</span>
              <span class="kpi-icon">ü™ñ</span>
            </div>
            <div class="kpi-value" id="terreCount">0</div>
            <div class="kpi-label">unit√©s cr√©√©es</div>
          </div>

          <div class="kpi-card naval">
            <div class="kpi-header">
              <span class="kpi-title">Unit√©s Naval</span>
              <span class="kpi-icon">‚öì</span>
            </div>
            <div class="kpi-value" id="navalCount">0</div>
            <div class="kpi-label">unit√©s cr√©√©es</div>
          </div>

          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-title">Total</span>
              <span class="kpi-icon">üéØ</span>
            </div>
            <div class="kpi-value" id="totalCount">0</div>
            <div class="kpi-label">toutes cat√©gories</div>
          </div>
        </div>

        <!-- Chart -->
        <div class="content-card">
          <h2>R√©partition des unit√©s par cat√©gorie</h2>
          <div class="chart-container">
            <div class="bar-chart" id="barChart">
              <div class="bar air" style="height: 0%">
                <span class="bar-value" id="barAir">0</span>
              </div>
              <div class="bar terre" style="height: 0%">
                <span class="bar-value" id="barTerre">0</span>
              </div>
              <div class="bar naval" style="height: 0%">
                <span class="bar-value" id="barNaval">0</span>
              </div>
            </div>
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px">
              <span class="bar-label">‚úàÔ∏è Air</span>
              <span class="bar-label">ü™ñ Terre</span>
              <span class="bar-label">‚öì Naval</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="content-card">
          <h2>Actions rapides</h2>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <button class="btn-primary" onclick="switchSection('units')">‚ûï Ajouter une unit√©</button>
            <button class="btn-primary" onclick="exportData()">üì• Exporter les donn√©es</button>
            <button class="btn-primary" onclick="document.getElementById('importFile').click()">üì§ Importer</button>
            <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
          </div>
        </div>
      </section>

      <!-- Units Management Section -->
      <section id="units" class="section">
        <div class="content-card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">Ajouter / Modifier une unit√©</h2>
            <a href="#" id="backToPage" class="btn-secondary" style="display: none; text-decoration: none;">
              ‚Üê Retour √† la page
            </a>
          </div>
          
          <!-- Quick Add Badge -->
          <div id="quickAddBadge" style="display: none; background: var(--brand); color: white; padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: 600;">
            <span id="badgeIcon"></span> Ajout rapide : <span id="badgeCategory"></span>
          </div>
          
          <div class="info-box">
            <strong>üíæ Stockage local</strong> : Les donn√©es sont sauvegard√©es dans votre navigateur.
          </div>

          <form id="unitForm">
            <div class="form-group" id="categoryGroup">
              <label>Cat√©gorie</label>
              <select id="unitCategory" required>
                <option value="">S√©lectionner...</option>
                <option value="air">‚úàÔ∏è Air</option>
                <option value="terre">ü™ñ Terre</option>
                <option value="naval">‚öì Naval</option>
              </select>
            </div>

            <div class="form-group">
              <label>Nom de l'unit√©</label>
              <input type="text" id="unitName" required placeholder="Ex: ASF, Chars, Croiseur">
            </div>

            <div class="form-group">
              <label>Description courte</label>
              <input type="text" id="unitDesc" required placeholder="Ex: Sup√©riorit√© a√©rienne">
            </div>

            <div class="form-group">
              <label>Tag (ex: SUPERIORITY, CAPTURE, etc.)</label>
              <input type="text" id="unitTag" placeholder="Optionnel">
            </div>

            <div class="form-group">
              <label>Efficace contre (liste s√©par√©e par des virgules)</label>
              <textarea id="unitEffective" placeholder="Ex: Chasseurs, Bombardiers, H√©licopt√®res"></textarea>
            </div>

            <div class="form-group">
              <label>Faible contre (liste s√©par√©e par des virgules)</label>
              <textarea id="unitWeak" placeholder="Ex: ASF, Missiles AA"></textarea>
            </div>

            <div class="form-group">
              <label>√Ä ne pas faire (liste s√©par√©e par des virgules)</label>
              <textarea id="unitDont" placeholder="Ex: Engager sans couverture, Rester immobile"></textarea>
            </div>

            <div class="form-group">
              <label>Mots-cl√©s pour la recherche</label>
              <input type="text" id="unitKeywords" placeholder="Ex: asf chasseur superiority avion">
            </div>

            <button type="submit" class="btn-primary" id="submitBtn">Ajouter l'unit√©</button>
            <button type="button" class="btn-secondary hidden" id="cancelEdit">Annuler</button>
          </form>
        </div>

        <!-- Units List -->
        <div class="content-card">
          <h2>Liste des unit√©s</h2>
          <div id="unitsList"></div>
        </div>
      </section>

      <!-- Activity Section -->
      <section id="activity" class="section">
        <div class="content-card">
          <h2>Activit√© r√©cente</h2>
          <div id="activityLog">
            <div class="activity-item">
              <div class="activity-icon">üìù</div>
              <div class="activity-content">
                <div class="activity-title">Dashboard initialis√©</div>
                <div class="activity-time">Il y a quelques instants</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings" class="section">
        <div class="content-card">
          <h2>Param√®tres du site</h2>
          
          <div class="form-group">
            <label>Nom de l'alliance</label>
            <input type="text" value="Alliance Napol√©oniens" id="siteName">
          </div>

          <div class="form-group">
            <label>Nombre de membres Discord</label>
            <input type="number" value="84" id="memberCount">
          </div>

          <div class="form-group">
            <label>Mot de passe Admin</label>
            <input type="password" placeholder="Nouveau mot de passe (optionnel)" id="newPassword">
          </div>

          <button class="btn-primary">üíæ Sauvegarder les param√®tres</button>
        </div>

        <div class="content-card">
          <h2>Import / Export des donn√©es</h2>
          <p style="color: var(--muted); margin-bottom: 20px">
            Exportez vos unit√©s pour les sauvegarder ou les partager avec d'autres admins.
          </p>
          <button class="btn-primary" onclick="exportData()">üì• Exporter toutes les unit√©s</button>
          <button class="btn-primary" onclick="document.getElementById('importFile2').click()" style="margin-left: 10px">üì§ Importer des unit√©s</button>
          <input type="file" id="importFile2" accept=".json" style="display:none" onchange="importData(event)">
        </div>

        <div class="content-card">
          <h2>‚ö†Ô∏è Zone dangereuse</h2>
          <p style="color: var(--muted); margin-bottom: 20px">
            Actions irr√©versibles. Utilisez avec pr√©caution.
          </p>
          <button class="btn-danger" onclick="clearAllData()">üóëÔ∏è Supprimer toutes les donn√©es</button>
        </div>
      </section>
    </main>
  </div>

  <script>
    // V√©rifier l'authentification au chargement
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
      window.location.href = 'login.html';
    }

    // Pr√©-s√©lectionner la cat√©gorie si pass√©e en param√®tre URL
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category');
    
    // Elements
    const logoutBtn = document.getElementById('logoutBtn');
    const unitForm = document.getElementById('unitForm');
    const unitsList = document.getElementById('unitsList');
    const submitBtn = document.getElementById('submitBtn');
    const cancelEdit = document.getElementById('cancelEdit');
    const pageTitle = document.getElementById('pageTitle');

    let currentEditId = null;
    let units = JSON.parse(localStorage.getItem('ww3_units') || '{}');
    let activityLog = JSON.parse(localStorage.getItem('ww3_activity') || '[]');

    // Navigation
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('.section');

    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        const sectionId = link.getAttribute('data-section');
        switchSection(sectionId);
      });
    });

    window.switchSection = (sectionId) => {
      // Update active nav
      navLinks.forEach(l => l.classList.remove('active'));
      const activeLink = document.querySelector(`[data-section="${sectionId}"]`);
      if (activeLink) activeLink.classList.add('active');

      // Show section
      sections.forEach(s => s.classList.remove('active'));
      const activeSection = document.getElementById(sectionId);
      if (activeSection) activeSection.classList.add('active');

      // Update title
      const titles = {
        overview: 'Vue d\'ensemble',
        units: 'Gestion des Unit√©s',
        activity: 'Activit√© r√©cente',
        settings: 'Param√®tres'
      };
      pageTitle.textContent = titles[sectionId] || 'Dashboard';

      // Si on va sur units et qu'il y a un param√®tre category
      if (sectionId === 'units' && categoryParam) {
        document.getElementById('unitCategory').value = categoryParam;
      }
    };

    // Si param√®tre category pr√©sent, aller directement √† la section units
    if (categoryParam) {
      switchSection('units');
      
      // Mode "Quick Add"
      document.getElementById('categoryGroup').style.display = 'none';
      document.getElementById('quickAddBadge').style.display = 'block';
      
      const categoryNames = {
        air: '‚úàÔ∏è Air',
        terre: 'ü™ñ Terre',
        naval: '‚öì Naval'
      };
      
      const categoryIcons = {
        air: '‚úàÔ∏è',
        terre: 'ü™ñ',
        naval: '‚öì'
      };
      
      document.getElementById('badgeIcon').textContent = categoryIcons[categoryParam];
      document.getElementById('badgeCategory').textContent = categoryNames[categoryParam];
      
      // Bouton retour
      const backBtn = document.getElementById('backToPage');
      backBtn.style.display = 'inline-block';
      backBtn.href = categoryParam + '.html';
      backBtn.textContent = `‚Üê Retour √† ${categoryNames[categoryParam]}`;
    }

    // Logout
    logoutBtn.addEventListener('click', () => {
      if (confirm('Se d√©connecter ?')) {
        localStorage.removeItem('adminLoggedIn');
        localStorage.removeItem('adminLoginTime');
        window.location.href = 'login.html';
      }
    });

    // Update statistics
    function updateStats() {
      const stats = {
        air: 0,
        terre: 0,
        naval: 0,
        total: 0
      };

      Object.values(units).forEach(unit => {
        if (unit.category) {
          stats[unit.category]++;
          stats.total++;
        }
      });

      // Update KPI cards
      document.getElementById('airCount').textContent = stats.air;
      document.getElementById('terreCount').textContent = stats.terre;
      document.getElementById('navalCount').textContent = stats.naval;
      document.getElementById('totalCount').textContent = stats.total;

      // Update chart
      const maxValue = Math.max(stats.air, stats.terre, stats.naval, 1);
      document.querySelector('.bar.air').style.height = `${(stats.air / maxValue) * 100}%`;
      document.querySelector('.bar.terre').style.height = `${(stats.terre / maxValue) * 100}%`;
      document.querySelector('.bar.naval').style.height = `${(stats.naval / maxValue) * 100}%`;
      
      document.getElementById('barAir').textContent = stats.air;
      document.getElementById('barTerre').textContent = stats.terre;
      document.getElementById('barNaval').textContent = stats.naval;
    }

    // Add/Edit Unit
    unitForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const unitData = {
        category: document.getElementById('unitCategory').value,
        name: document.getElementById('unitName').value,
        description: document.getElementById('unitDesc').value,
        tag: document.getElementById('unitTag').value,
        effective: document.getElementById('unitEffective').value.split(',').map(s => s.trim()).filter(s => s),
        weak: document.getElementById('unitWeak').value.split(',').map(s => s.trim()).filter(s => s),
        dont: document.getElementById('unitDont').value.split(',').map(s => s.trim()).filter(s => s),
        keywords: document.getElementById('unitKeywords').value
      };

      if (currentEditId) {
        units[currentEditId] = unitData;
        addActivity('‚úèÔ∏è', `Unit√© modifi√©e : ${unitData.name}`, 'edit');
      } else {
        const id = Date.now().toString();
        units[id] = unitData;
        addActivity('‚ûï', `Nouvelle unit√© : ${unitData.name}`, 'create');
      }

      localStorage.setItem('ww3_units', JSON.stringify(units));
      
      unitForm.reset();
      currentEditId = null;
      submitBtn.textContent = 'Ajouter l\'unit√©';
      cancelEdit.classList.add('hidden');
      loadUnits();
      updateStats();
      
      // Si mode quick add, proposer de retourner √† la page
      if (categoryParam) {
        const categoryNames = { air: 'Air', terre: 'Terre', naval: 'Naval' };
        if (confirm(`‚úÖ Unit√© ajout√©e ! Retourner √† la page ${categoryNames[categoryParam]} ?`)) {
          window.location.href = categoryParam + '.html';
        } else {
          // Re-s√©lectionner la cat√©gorie pour le prochain ajout
          document.getElementById('unitCategory').value = categoryParam;
        }
      } else {
        alert(`Unit√© ${currentEditId ? 'modifi√©e' : 'ajout√©e'} avec succ√®s !`);
      }
    });

    // Cancel edit
    cancelEdit.addEventListener('click', () => {
      unitForm.reset();
      currentEditId = null;
      submitBtn.textContent = 'Ajouter l\'unit√©';
      cancelEdit.classList.add('hidden');
    });

    // Load units
    function loadUnits() {
      unitsList.innerHTML = '';
      
      if (Object.keys(units).length === 0) {
        unitsList.innerHTML = '<p style="color: var(--muted)">Aucune unit√© pour le moment</p>';
        return;
      }

      // Group by category
      const grouped = { air: [], terre: [], naval: [] };
      Object.entries(units).forEach(([id, unit]) => {
        if (grouped[unit.category]) {
          grouped[unit.category].push({ id, ...unit });
        }
      });

      // Display by category
      Object.entries(grouped).forEach(([category, categoryUnits]) => {
        if (categoryUnits.length > 0) {
          const categoryTitle = document.createElement('h3');
          categoryTitle.textContent = `${category === 'air' ? '‚úàÔ∏è Air' : category === 'terre' ? 'ü™ñ Terre' : '‚öì Naval'} (${categoryUnits.length})`;
          categoryTitle.style.marginTop = '20px';
          categoryTitle.style.marginBottom = '15px';
          categoryTitle.style.color = 'var(--brand)';
          unitsList.appendChild(categoryTitle);

          categoryUnits.forEach(unit => {
            const div = document.createElement('div');
            div.className = 'unit-item';
            div.innerHTML = `
              <div class="unit-info">
                <h3>${unit.name}</h3>
                <p>${unit.description}</p>
              </div>
              <div>
                <button class="btn-primary" onclick="editUnit('${unit.id}')">‚úèÔ∏è Modifier</button>
                <button class="btn-danger" onclick="deleteUnit('${unit.id}')">üóëÔ∏è Supprimer</button>
              </div>
            `;
            unitsList.appendChild(div);
          });
        }
      });
    }

    // Edit unit
    window.editUnit = (id) => {
      const unit = units[id];
      document.getElementById('unitCategory').value = unit.category;
      document.getElementById('unitName').value = unit.name;
      document.getElementById('unitDesc').value = unit.description;
      document.getElementById('unitTag').value = unit.tag || '';
      document.getElementById('unitEffective').value = unit.effective.join(', ');
      document.getElementById('unitWeak').value = unit.weak.join(', ');
      document.getElementById('unitDont').value = unit.dont.join(', ');
      document.getElementById('unitKeywords').value = unit.keywords;
      
      currentEditId = id;
      submitBtn.textContent = 'Modifier l\'unit√©';
      cancelEdit.classList.remove('hidden');
      
      // Switch to units section and scroll to top
      switchSection('units');
      window.scrollTo(0, 0);
    };

    // Delete unit
    window.deleteUnit = (id) => {
      const unit = units[id];
      if (confirm(`Supprimer l'unit√© "${unit.name}" ?`)) {
        addActivity('üóëÔ∏è', `Unit√© supprim√©e : ${unit.name}`, 'delete');
        delete units[id];
        localStorage.setItem('ww3_units', JSON.stringify(units));
        loadUnits();
        updateStats();
      }
    };

    // Activity Log
    function addActivity(icon, text, type) {
      const activity = {
        icon,
        text,
        type,
        time: new Date().toISOString()
      };
      
      activityLog.unshift(activity);
      if (activityLog.length > 50) activityLog = activityLog.slice(0, 50);
      
      localStorage.setItem('ww3_activity', JSON.stringify(activityLog));
      loadActivity();
    }

    function loadActivity() {
      const activityLogEl = document.getElementById('activityLog');
      if (!activityLogEl) return;
      
      activityLogEl.innerHTML = '';
      
      if (activityLog.length === 0) {
        activityLogEl.innerHTML = '<p style="color: var(--muted)">Aucune activit√© r√©cente</p>';
        return;
      }

      activityLog.slice(0, 20).forEach(activity => {
        const timeAgo = getTimeAgo(new Date(activity.time));
        const div = document.createElement('div');
        div.className = 'activity-item';
        div.innerHTML = `
          <div class="activity-icon">${activity.icon}</div>
          <div class="activity-content">
            <div class="activity-title">${activity.text}</div>
            <div class="activity-time">${timeAgo}</div>
          </div>
        `;
        activityLogEl.appendChild(div);
      });
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      
      if (seconds < 60) return 'Il y a quelques instants';
      if (seconds < 3600) return `Il y a ${Math.floor(seconds / 60)} min`;
      if (seconds < 86400) return `Il y a ${Math.floor(seconds / 3600)}h`;
      return `Il y a ${Math.floor(seconds / 86400)} jour(s)`;
    }

    // Export data
    window.exportData = () => {
      const dataStr = JSON.stringify(units, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'ww3-units-' + new Date().toISOString().slice(0,10) + '.json';
      link.click();
      
      addActivity('üì•', 'Donn√©es export√©es', 'export');
    };

    // Import data
    window.importData = (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const importedUnits = JSON.parse(e.target.result);
            if (confirm('Remplacer toutes les unit√©s existantes par les donn√©es import√©es ?')) {
              units = importedUnits;
              localStorage.setItem('ww3_units', JSON.stringify(units));
              loadUnits();
              updateStats();
              addActivity('üì§', 'Donn√©es import√©es', 'import');
              alert('Donn√©es import√©es avec succ√®s !');
            }
          } catch (err) {
            alert('Erreur lors de l\'import : fichier invalide');
          }
        };
        reader.readAsText(file);
      }
    };

    // Clear all data
    window.clearAllData = () => {
      if (confirm('‚ö†Ô∏è ATTENTION : Cette action supprimera TOUTES les unit√©s. Continuer ?')) {
        if (confirm('√ätes-vous VRAIMENT s√ªr ? Cette action est irr√©versible !')) {
          units = {};
          localStorage.setItem('ww3_units', JSON.stringify(units));
          loadUnits();
          updateStats();
          addActivity('‚ö†Ô∏è', 'Toutes les donn√©es ont √©t√© supprim√©es', 'clear');
          alert('Toutes les donn√©es ont √©t√© supprim√©es');
        }
      }
    };

    // Initialize
    loadUnits();
    updateStats();
    loadActivity();
    
    // Add initial activity if empty
    if (activityLog.length === 0) {
      addActivity('üöÄ', 'Dashboard initialis√©', 'init');
    }
  </script>
</body>
</html>
