<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Unit√©s - Alliance Napol√©oniens</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container {
      max-width: 900px;
      margin: 50px auto;
      padding: 30px;
    }
    
    .admin-panel {
      background: var(--panel);
      padding: 30px;
      border-radius: var(--r);
      border: 1px solid var(--line);
      position: relative;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text);
      font-weight: 600;
    }
    
    .form-group input, 
    .form-group textarea, 
    .form-group select {
      width: 100%;
      padding: 12px;
      background: var(--panel2);
      border: 1px solid var(--line);
      border-radius: 8px;
      color: var(--text);
      font-family: inherit;
      box-sizing: border-box;
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .btn-primary {
      background: var(--brand);
      color: var(--bg);
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 16px;
      transition: opacity 0.2s;
    }
    
    .btn-primary:hover {
      opacity: 0.9;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
    }
    
    .hidden {
      display: none;
    }
    
    .unit-list {
      margin-top: 30px;
    }
    
    .unit-item {
      background: var(--panel2);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .unit-info h3 {
      margin: 0 0 5px 0;
      color: var(--brand);
    }
    
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .logout-btn {
      background: var(--danger);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    
    .info-box {
      background: var(--panel2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--warn);
    }
  </style>
</head>
<body>
  
  <div class="admin-container">
    <div class="admin-panel">
      <div class="header-bar">
        <h1>‚öôÔ∏è Gestion des Unit√©s</h1>
        <button class="logout-btn" id="logoutBtn">üö™ D√©connexion</button>
      </div>
      
      <p style="color: var(--muted); margin-bottom: 20px">Ajouter, modifier ou supprimer des unit√©s militaires</p>

      <div class="info-box">
        <strong>üíæ Stockage local</strong> : Les donn√©es sont sauvegard√©es dans votre navigateur. 
        Pour partager avec d'autres admins, exportez les donn√©es.
      </div>

      <!-- Add/Edit Form -->
      <form id="unitForm">
        <div class="form-group">
          <label>Cat√©gorie</label>
          <select id="unitCategory" required>
            <option value="">S√©lectionner...</option>
            <option value="air">Air</option>
            <option value="terre">Terre</option>
            <option value="naval">Naval</option>
          </select>
        </div>

        <div class="form-group">
          <label>Nom de l'unit√©</label>
          <input type="text" id="unitName" required placeholder="Ex: ASF, Chars, Croiseur">
        </div>

        <div class="form-group">
          <label>Description courte</label>
          <input type="text" id="unitDesc" required placeholder="Ex: Sup√©riorit√© a√©rienne">
        </div>

        <div class="form-group">
          <label>Tag (ex: SUPERIORITY, CAPTURE, etc.)</label>
          <input type="text" id="unitTag" placeholder="Optionnel">
        </div>

        <div class="form-group">
          <label>Efficace contre (liste s√©par√©e par des virgules)</label>
          <textarea id="unitEffective" placeholder="Ex: Chasseurs, Bombardiers, H√©licopt√®res"></textarea>
        </div>

        <div class="form-group">
          <label>Faible contre (liste s√©par√©e par des virgules)</label>
          <textarea id="unitWeak" placeholder="Ex: ASF, Missiles AA"></textarea>
        </div>

        <div class="form-group">
          <label>√Ä ne pas faire (liste s√©par√©e par des virgules)</label>
          <textarea id="unitDont" placeholder="Ex: Engager sans couverture, Rester immobile"></textarea>
        </div>

        <div class="form-group">
          <label>Mots-cl√©s pour la recherche</label>
          <input type="text" id="unitKeywords" placeholder="Ex: asf chasseur superiority avion">
        </div>

        <button type="submit" class="btn-primary" id="submitBtn">Ajouter l'unit√©</button>
        <button type="button" class="btn-danger hidden" id="cancelEdit">Annuler</button>
      </form>

      <!-- Units List -->
      <div class="unit-list">
        <h2>Unit√©s existantes</h2>
        <div id="unitsList"></div>
      </div>

      <!-- Export/Import -->
      <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--line)">
        <h2>Import / Export</h2>
        <button class="btn-primary" onclick="exportData()">üì• Exporter les donn√©es</button>
        <button class="btn-primary" onclick="document.getElementById('importFile').click()" style="margin-left: 10px">üì§ Importer des donn√©es</button>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
      </div>
    </div>
  </div>

  <script>
    // V√©rifier l'authentification au chargement
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
      window.location.href = 'login.html';
    }

    // Pr√©-s√©lectionner la cat√©gorie si pass√©e en param√®tre URL
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category');
    if (categoryParam) {
      document.getElementById('unitCategory').value = categoryParam;
    }

    // Elements
    const logoutBtn = document.getElementById('logoutBtn');
    const unitForm = document.getElementById('unitForm');
    const unitsList = document.getElementById('unitsList');
    const submitBtn = document.getElementById('submitBtn');
    const cancelEdit = document.getElementById('cancelEdit');

    let currentEditId = null;
    let units = JSON.parse(localStorage.getItem('ww3_units') || '{}');

    // Logout
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('adminLoggedIn');
      localStorage.removeItem('adminLoginTime');
      window.location.href = 'login.html';
    });

    // Charger les unit√©s au d√©marrage
    displayUnits();

    // Add/Edit Unit
    unitForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const unitData = {
        category: document.getElementById('unitCategory').value,
        name: document.getElementById('unitName').value,
        description: document.getElementById('unitDesc').value,
        tag: document.getElementById('unitTag').value,
        effective: document.getElementById('unitEffective').value.split(',').map(s => s.trim()).filter(s => s),
        weak: document.getElementById('unitWeak').value.split(',').map(s => s.trim()).filter(s => s),
        dont: document.getElementById('unitDont').value.split(',').map(s => s.trim()).filter(s => s),
        keywords: document.getElementById('unitKeywords').value
      };

      if (currentEditId) {
        units[currentEditId] = unitData;
      } else {
        const id = Date.now().toString();
        units[id] = unitData;
      }

      localStorage.setItem('ww3_units', JSON.stringify(units));
      
      unitForm.reset();
      currentEditId = null;
      submitBtn.textContent = 'Ajouter l\'unit√©';
      cancelEdit.classList.add('hidden');
      loadUnits();
    });

    // Cancel edit
    cancelEdit.addEventListener('click', () => {
      unitForm.reset();
      currentEditId = null;
      submitBtn.textContent = 'Ajouter l\'unit√©';
      cancelEdit.classList.add('hidden');
    });

    // Load units
    function loadUnits() {
      unitsList.innerHTML = '';
      
      if (Object.keys(units).length === 0) {
        unitsList.innerHTML = '<p style="color: var(--muted)">Aucune unit√© pour le moment</p>';
        return;
      }

      Object.entries(units).forEach(([id, unit]) => {
        const div = document.createElement('div');
        div.className = 'unit-item';
        div.innerHTML = `
          <div class="unit-info">
            <h3>${unit.name}</h3>
            <p style="color: var(--muted); margin: 0">${unit.category.toUpperCase()} - ${unit.description}</p>
          </div>
          <div>
            <button class="btn-primary" onclick="editUnit('${id}')">Modifier</button>
            <button class="btn-danger" onclick="deleteUnit('${id}')">Supprimer</button>
          </div>
        `;
        unitsList.appendChild(div);
      });
    }

    // Edit unit
    window.editUnit = (id) => {
      const unit = units[id];
      document.getElementById('unitCategory').value = unit.category;
      document.getElementById('unitName').value = unit.name;
      document.getElementById('unitDesc').value = unit.description;
      document.getElementById('unitTag').value = unit.tag || '';
      document.getElementById('unitEffective').value = unit.effective.join(', ');
      document.getElementById('unitWeak').value = unit.weak.join(', ');
      document.getElementById('unitDont').value = unit.dont.join(', ');
      document.getElementById('unitKeywords').value = unit.keywords;
      
      currentEditId = id;
      submitBtn.textContent = 'Modifier l\'unit√©';
      cancelEdit.classList.remove('hidden');
      window.scrollTo(0, 0);
    };

    // Delete unit
    window.deleteUnit = (id) => {
      if (confirm('Supprimer cette unit√© ?')) {
        delete units[id];
        localStorage.setItem('ww3_units', JSON.stringify(units));
        loadUnits();
      }
    };

    // Export data
    window.exportData = () => {
      const dataStr = JSON.stringify(units, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'ww3-units-' + new Date().toISOString().slice(0,10) + '.json';
      link.click();
    };

    // Import data
    window.importData = (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const importedUnits = JSON.parse(e.target.result);
            if (confirm('Remplacer toutes les unit√©s existantes par les donn√©es import√©es ?')) {
              units = importedUnits;
              localStorage.setItem('ww3_units', JSON.stringify(units));
              loadUnits();
              alert('Donn√©es import√©es avec succ√®s !');
            }
          } catch (err) {
            alert('Erreur lors de l\'import : fichier invalide');
          }
        };
        reader.readAsText(file);
      }
    };
  </script>
</body>
</html>
