<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Outils â€” Alliance NapolÃ©oniens</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="topbar">
  <div class="inner">
    <a href="index.html" class="brand" style="text-decoration:none; color:inherit; display:flex; align-items:center; cursor:pointer;">
      <img src="napo.png" alt="Logo Alliance" style="height:150px; margin-right:8px">
      <span style="display:flex; align-items:center; justify-content:center; height:150px; flex:1; font-size:42px; font-weight:900; color:#fbbf24; text-shadow:2px 2px 4px rgba(0,0,0,0.5); font-family:Georgia, serif; letter-spacing:1px">Alliance NapolÃ©oniens</span>
    </a>
    <div class="burger-menu" id="burgerMenu">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav id="nav">
      <div class="dropdown">
        <div class="dropdown-toggle">ğŸ“š Documentation</div>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="infanterie.html">Infanterie</a>
          <a class="dropdown-item" href="blindes.html">BlindÃ©s</a>
          <a class="dropdown-item" href="soutien.html">Soutien</a>
          <a class="dropdown-item" href="missiles.html">Missiles</a>
          <a class="dropdown-item" href="chasseurs.html">Chasseurs</a>
          <a class="dropdown-item" href="bombardiers.html">Bombardiers</a>
          <a class="dropdown-item" href="naval.html">Naval</a>
        </div>
      </div>
      <div class="dropdown">
        <div class="dropdown-toggle">ğŸ“ Ã‰cole</div>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="demande-prof.html">ğŸ‘¨â€ğŸ« Demande de prof</a>
          <a class="dropdown-item" href="idee1.html">ğŸ’¡ IdÃ©e 1</a>
          <a class="dropdown-item" href="idee2.html">ğŸ’¡ IdÃ©e 2</a>
        </div>
      </div>
      <a class="navlink" href="tactiques.html">ğŸ¯ Tactiques</a>
      <a class="navlink" href="guide.html">ğŸ“– Guide</a>
      <a class="navlink" href="communaute.html">ğŸ‘¥ CommunautÃ©</a>
      <a class="navlink active" href="outils.html">ğŸ§® Outils</a>
    </nav>
  </div>
</header>

<script>
const burger = document.getElementById('burgerMenu');
const nav = document.getElementById('nav');
if (burger && nav) {
  burger.addEventListener('click', () => {
    burger.classList.toggle('active');
    nav.classList.toggle('active');
  });
}

// Dropdown menus
const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
dropdownToggles.forEach(toggle => {
  toggle.addEventListener('click', (e) => {
    e.stopPropagation();
    const menu = toggle.nextElementSibling;
    document.querySelectorAll('.dropdown-menu').forEach(m => {
      if (m !== menu) m.classList.remove('show');
    });
    menu.classList.toggle('show');
  });
});
document.addEventListener('click', () => {
  document.querySelectorAll('.dropdown-menu').forEach(menu => {
    menu.classList.remove('show');
  });
});
</script>

<main class="container">
  <section class="hero">
    <div class="pad">
      <h1 class="h-title">ğŸ§® Calculateur de Combat</h1>
      <p class="h-sub">Simulez des batailles entre unitÃ©s et estimez les rÃ©sultats</p>
    </div>
  </section>

  <section style="margin-top:20px;">
    <div class="card">
      <div class="hd">
        <h2 style="margin:0; font-size:20px;">âš”ï¸ Configuration du Combat</h2>
      </div>
      <div class="bd" style="padding:20px;">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:25px;">
          <!-- Attaquant -->
          <div>
            <h3 style="color:var(--danger); margin-bottom:15px;">ğŸ—¡ï¸ Attaquant</h3>
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">CatÃ©gorie</label>
              <select id="attackerCategory" onchange="loadAttackerUnits()" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
                <option value="">SÃ©lectionner une catÃ©gorie</option>
                <option value="infanterie">Infanterie</option>
                <option value="blindÃ©s">BlindÃ©s</option>
                <option value="soutien">Soutien</option>
                <option value="missiles">Missiles</option>
                <option value="air">Aviation</option>
                <option value="mer">Naval</option>
              </select>
            </div>
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">UnitÃ©</label>
              <select id="attackerUnit" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
                <option value="">Choisir d'abord une catÃ©gorie</option>
              </select>
            </div>
            <div>
              <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">Nombre d'unitÃ©s</label>
              <input type="number" id="attackerCount" value="10" min="1" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
            </div>
          </div>

          <!-- DÃ©fenseur -->
          <div>
            <h3 style="color:var(--ok); margin-bottom:15px;">ğŸ›¡ï¸ DÃ©fenseur</h3>
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">CatÃ©gorie</label>
              <select id="defenderCategory" onchange="loadDefenderUnits()" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
                <option value="">SÃ©lectionner une catÃ©gorie</option>
                <option value="infanterie">Infanterie</option>
                <option value="blindÃ©s">BlindÃ©s</option>
                <option value="soutien">Soutien</option>
                <option value="missiles">Missiles</option>
                <option value="air">Aviation</option>
                <option value="mer">Naval</option>
              </select>
            </div>
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">UnitÃ©</label>
              <select id="defenderUnit" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
                <option value="">Choisir d'abord une catÃ©gorie</option>
              </select>
            </div>
            <div>
              <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">Nombre d'unitÃ©s</label>
              <input type="number" id="defenderCount" value="10" min="1" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
            </div>
          </div>
        </div>

        <!-- Terrain -->
        <div style="margin-bottom:25px;">
          <label style="display:block; margin-bottom:5px; color:var(--muted); font-size:14px;">ğŸ—ºï¸ Type de terrain</label>
          <select id="terrain" style="width:100%; padding:10px; background:var(--panel2); border:1px solid var(--line); border-radius:8px; color:var(--text); font-size:14px;">
            <option value="degage">Terrain DÃ©gagÃ©</option>
            <option value="montagnes">Montagnes</option>
            <option value="forets">ForÃªts</option>
            <option value="urbain">Urbain</option>
            <option value="banlieue">Banlieue</option>
            <option value="jungle">Jungle</option>
            <option value="toundra">Toundra</option>
            <option value="desert">DÃ©sert</option>
            <option value="mer">Mer</option>
            <option value="aviation">Aviation</option>
          </select>
        </div>

        <button onclick="simulateCombat()" class="btn" style="width:100%; padding:15px; font-size:16px; font-weight:600;">âš”ï¸ Simuler le Combat</button>
      </div>
    </div>

    <!-- RÃ©sultats -->
    <div id="results" style="margin-top:20px; display:none;">
      <div class="card">
        <div class="hd">
          <h2 style="margin:0; font-size:20px;">ğŸ“Š RÃ©sultats de la Simulation</h2>
        </div>
        <div class="bd" style="padding:20px;">
          <div id="resultsContent"></div>
        </div>
      </div>
    </div>
  </section>

  <footer class="main-footer">
    <div class="footer-content">
      <div class="footer-col">
        <h3>Ã€ propos</h3>
        <p class="footer-text">
          Alliance NapolÃ©onienne sur Conflict of Nations WW3. Jouable sur mobile, tablette et PC. 
          84 membres actifs sur Discord. Rejoignez-nous pour lancer des parties entre membres !
        </p>
      </div>
      
      <div class="footer-col">
        <h3>Navigation</h3>
        <ul class="footer-links">
          <li><a href="index.html">Accueil</a></li>
          <li><a href="infanterie.html">ğŸª– Infanterie</a></li>
          <li><a href="blindes.html">ğŸ›¡ï¸ BlindÃ©s</a></li>
          <li><a href="soutien.html">ğŸ’£ Soutien</a></li>
          <li><a href="missiles.html">ğŸš€ Missiles</a></li>
          <li><a href="chasseurs.html">âœˆï¸ Chasseurs</a></li>
          <li><a href="bombardiers.html">ğŸ›©ï¸ Bombardiers</a></li>
          <li><a href="naval.html">âš“ Naval</a></li>
        </ul>
      </div>
      
      <div class="footer-col">
        <h3>CommunautÃ©</h3>
        <ul class="footer-links">
          <li><a href="https://discord.gg/z99qUe52PN" target="_blank">ğŸ’¬ Discord</a></li>
          <li><a href="#">ğŸ“§ Contact (lien Ã  ajouter)</a></li>
          <li><a href="login.html">ğŸ” Connexion Admin</a></li>
        </ul>
      </div>
      
      <div class="footer-col">
        <h3>Informations</h3>
        <ul class="footer-links">
          <li>ğŸ“… DerniÃ¨re MAJ : DÃ©c. 2025</li>
          <li>ğŸ® Jeu : Conflict of Nations WW3</li>
          <li>âš”ï¸ Alliance : Les NapolÃ©oniens</li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      Â© Alliance NapolÃ©oniens â€” dÃ©veloppÃ© par Jerem32 & dÃ©ployÃ© par Cloudflare Pages
      <span style="margin-left: 20px">|</span>
      <a href="admin.html" style="margin-left: 20px; color: var(--brand)">ğŸ” Admin</a>
      <span style="margin-left: 10px">|</span>
      <a href="#" id="openAdminModal" style="margin-left: 10px; color: var(--brand)">ğŸ‘¥ Ã‰quipe d'admin</a>
    </div>
  </footer>

  <div id="adminModal" class="modal">
    <div class="modal-content">
      <span class="modal-close">&times;</span>
      <h2 style="color: var(--brand); margin-bottom: 20px;">ğŸ‘¥ Administrateurs</h2>
      <ul style="list-style: none; padding: 0;">
        <li style="padding: 15px; background: var(--panel2); margin-bottom: 10px; border-radius: 8px; border-left: 4px solid var(--brand);">
          <strong style="color: var(--brand)">1.</strong> YtbCrocomc
        </li>
        <li style="padding: 15px; background: var(--panel2); margin-bottom: 10px; border-radius: 8px; border-left: 4px solid var(--brand);">
          <strong style="color: var(--brand)">2.</strong> nicotena
        </li>
        <li style="padding: 15px; background: var(--panel2); margin-bottom: 10px; border-radius: 8px; border-left: 4px solid var(--brand);">
          <strong style="color: var(--brand)">3.</strong> PUFRUH
        </li>
      </ul>
      <a href="login.html" style="display: block; margin-top: 20px; padding: 12px; background: var(--brand); color: var(--bg); text-align: center; border-radius: 8px; text-decoration: none; font-weight: 600;">ğŸ” Connexion Admin</a>
    </div>
  </div>

  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      animation: fadeIn 0.3s;
    }

    .modal-content {
      background-color: var(--panel);
      margin: 10% auto;
      padding: 30px;
      border: 1px solid var(--line);
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      position: relative;
      animation: slideDown 0.3s;
    }

    .modal-close {
      color: var(--muted);
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: var(--brand);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @media (max-width: 768px) {
      .bd > div:first-child {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</main>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzSjb1psqTLL5AqoWHAGNVDOWKPYAOXWJoT2dkV-NzS_aSWBdKKIjXXTAhgN5lUBVTV/exec";
  let unitsData = [];

  // Charger les donnÃ©es au chargement de la page
  window.addEventListener('DOMContentLoaded', async () => {
    try {
      const response = await fetch(API_URL);
      const data = await response.json();
      unitsData = data;
    } catch (error) {
      console.error("Erreur lors du chargement des unitÃ©s:", error);
    }
  });

  const modal = document.getElementById('adminModal');
  const openBtn = document.getElementById('openAdminModal');
  const closeBtn = document.querySelector('.modal-close');

  if (openBtn && modal && closeBtn) {
    openBtn.onclick = function(e) {
      e.preventDefault();
      modal.style.display = 'block';
    }

    closeBtn.onclick = function() {
      modal.style.display = 'none';
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }
  }

  function loadAttackerUnits() {
    const category = document.getElementById('attackerCategory').value;
    const unitSelect = document.getElementById('attackerUnit');
    
    if (!category) {
      unitSelect.innerHTML = '<option value="">Choisir d'abord une catÃ©gorie</option>';
      return;
    }

    const filteredUnits = unitsData.filter(unit => unit.categorie.toLowerCase() === category.toLowerCase());
    
    unitSelect.innerHTML = '<option value="">SÃ©lectionner une unitÃ©</option>';
    filteredUnits.forEach(unit => {
      const option = document.createElement('option');
      option.value = JSON.stringify({
        nom: unit.nom,
        puissance: unit.puissance || unit.attaque || 100,
        defense: unit.defense || 80
      });
      option.textContent = `${unit.nom} (Att: ${unit.puissance || unit.attaque || '?'}, Def: ${unit.defense || '?'})`;
      unitSelect.appendChild(option);
    });
  }

  function loadDefenderUnits() {
    const category = document.getElementById('defenderCategory').value;
    const unitSelect = document.getElementById('defenderUnit');
    
    if (!category) {
      unitSelect.innerHTML = '<option value="">Choisir d'abord une catÃ©gorie</option>';
      return;
    }

    const filteredUnits = unitsData.filter(unit => unit.categorie.toLowerCase() === category.toLowerCase());
    
    unitSelect.innerHTML = '<option value="">SÃ©lectionner une unitÃ©</option>';
    filteredUnits.forEach(unit => {
      const option = document.createElement('option');
      option.value = JSON.stringify({
        nom: unit.nom,
        puissance: unit.puissance || unit.attaque || 100,
        defense: unit.defense || 80
      });
      option.textContent = `${unit.nom} (Att: ${unit.puissance || unit.attaque || '?'}, Def: ${unit.defense || '?'})`;
      unitSelect.appendChild(option);
    });
  }

  function simulateCombat() {
    // RÃ©cupÃ©rer les unitÃ©s sÃ©lectionnÃ©es
    const attackerSelect = document.getElementById('attackerUnit');
    const defenderSelect = document.getElementById('defenderUnit');
    
    if (!attackerSelect.value || !defenderSelect.value) {
      alert("Veuillez sÃ©lectionner une unitÃ© attaquante et une unitÃ© dÃ©fenseure.");
      return;
    }

    const attackerUnit = JSON.parse(attackerSelect.value);
    const defenderUnit = JSON.parse(defenderSelect.value);
    
    const attackerCount = parseInt(document.getElementById('attackerCount').value);
    const defenderCount = parseInt(document.getElementById('defenderCount').value);
    const terrain = document.getElementById('terrain').value;

    // Modificateurs de terrain
    let defenseBonus = 1;
    let terrainName = "Terrain DÃ©gagÃ©";
    
    switch(terrain) {
      case 'urbain':
        defenseBonus = 1.2;
        terrainName = "Urbain";
        break;
      case 'montagnes':
        defenseBonus = 1.3;
        terrainName = "Montagnes";
        break;
      case 'forets':
        defenseBonus = 1.15;
        terrainName = "ForÃªts";
        break;
      case 'banlieue':
        defenseBonus = 1.1;
        terrainName = "Banlieue";
        break;
      case 'jungle':
        defenseBonus = 1.15;
        terrainName = "Jungle";
        break;
      case 'toundra':
        defenseBonus = 1.0;
        terrainName = "Toundra";
        break;
      case 'desert':
        defenseBonus = 0.95;
        terrainName = "DÃ©sert";
        break;
      case 'mer':
        defenseBonus = 1.0;
        terrainName = "Mer";
        break;
      case 'aviation':
        defenseBonus = 1.0;
        terrainName = "Aviation";
        break;
    }

    // Calcul des dÃ©gÃ¢ts
    const totalAttackPower = attackerCount * attackerUnit.puissance;
    const totalDefensePower = defenderCount * defenderUnit.defense * defenseBonus;
    
    // Ratio d'efficacitÃ©
    const attackEfficiency = totalAttackPower / (totalDefensePower + 1);
    const defenseEfficiency = totalDefensePower / (totalAttackPower + 1);

    // Calcul des pertes
    let attackerLosses = Math.min(attackerCount, Math.round(attackerCount * defenseEfficiency * 0.5));
    let defenderLosses = Math.min(defenderCount, Math.round(defenderCount * attackEfficiency * 0.7));

    // DÃ©terminer le vainqueur
    const attackerSurvivors = attackerCount - attackerLosses;
    const defenderSurvivors = defenderCount - defenderLosses;
    
    let winner = "";
    let winnerColor = "";
    
    if (attackerSurvivors > defenderSurvivors * 1.5) {
      winner = "Victoire de l'Attaquant";
      winnerColor = "var(--danger)";
    } else if (defenderSurvivors > attackerSurvivors * 1.5) {
      winner = "Victoire du DÃ©fenseur";
      winnerColor = "var(--ok)";
    } else if (attackerSurvivors > defenderSurvivors) {
      winner = "Victoire SerrÃ©e de l'Attaquant";
      winnerColor = "var(--warn)";
    } else if (defenderSurvivors > attackerSurvivors) {
      winner = "Victoire SerrÃ©e du DÃ©fenseur";
      winnerColor = "var(--warn)";
    } else {
      winner = "Ã‰galitÃ© / Combat IndÃ©cis";
      winnerColor = "var(--muted)";
    }

    // Afficher les rÃ©sultats
    const resultsDiv = document.getElementById('results');
    const resultsContent = document.getElementById('resultsContent');
    
    resultsContent.innerHTML = `
      <div style="text-align:center; padding:20px; background:var(--panel2); border-radius:12px; margin-bottom:20px;">
        <h3 style="font-size:28px; margin:0; color:${winnerColor};">${winner}</h3>
        <p style="color:var(--muted); margin-top:5px;">Terrain: ${terrainName}</p>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
        <div style="padding:20px; background:rgba(251,113,133,0.1); border:2px solid var(--danger); border-radius:12px;">
          <h4 style="color:var(--danger); margin:0 0 15px 0;">ğŸ—¡ï¸ ${attackerUnit.nom}</h4>
          <div style="margin-bottom:10px;">
            <span style="color:var(--muted); font-size:14px;">UnitÃ©s initiales:</span>
            <span style="float:right; font-weight:bold;">${attackerCount}</span>
          </div>
          <div style="margin-bottom:10px;">
            <span style="color:var(--muted); font-size:14px;">Puissance d'attaque:</span>
            <span style="float:right; font-weight:bold;">${attackerUnit.puissance}</span>
          </div>
          <div style="margin-bottom:10px;">
            <span style="color:var(--muted); font-size:14px;">Pertes:</span>
            <span style="float:right; font-weight:bold; color:var(--danger);">-${attackerLosses}</span>
          </div>
          <div style="padding-top:10px; border-top:1px solid var(--line);">
            <span style="color:var(--muted); font-size:14px;">Survivants:</span>
            <span style="float:right; font-weight:bold; font-size:18px; color:var(--brand);">${attackerSurvivors}</span>
          </div>
        </div>

        <div style="padding:20px; background:rgba(52,211,153,0.1); border:2px solid var(--ok); border-radius:12px;">
          <h4 style="color:var(--ok); margin:0 0 15px 0;">ğŸ›¡ï¸ ${defenderUnit.nom}</h4>
          <div style="margin-bottom:10px;">
            <span style="color:var(--muted); font-size:14px;">UnitÃ©s initiales:</span>
            <span style="float:right; font-weight:bold;">${defenderCount}</span>
          </div>
          <div style="margin-bottom:10px;">
            <span style="color:var(--muted); font-size:14px;">DÃ©fense:</span>
            <span style="float:right; font-weight:bold;">${defenderUnit.defense}</span>
          </div>
          <div style="margin-bottom:10px;">
            <span style="color:var(--muted); font-size:14px;">Pertes:</span>
            <span style="float:right; font-weight:bold; color:var(--danger);">-${defenderLosses}</span>
          </div>
          <div style="padding-top:10px; border-top:1px solid var(--line);">
            <span style="color:var(--muted); font-size:14px;">Survivants:</span>
            <span style="float:right; font-weight:bold; font-size:18px; color:var(--brand);">${defenderSurvivors}</span>
          </div>
        </div>
      </div>

      <div style="padding:15px; background:var(--panel2); border-radius:8px; border-left:4px solid var(--brand);">
        <p style="margin:0; font-size:13px; color:var(--muted); font-style:italic;">
          âš ï¸ Cette simulation est approximative et basÃ©e sur des calculs simplifiÃ©s. 
          Les rÃ©sultats rÃ©els peuvent varier selon les doctrines, niveaux d'unitÃ©s et autres facteurs du jeu.
        </p>
      </div>
    `;

    resultsDiv.style.display = 'block';
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
</script>
</body>
</html>
